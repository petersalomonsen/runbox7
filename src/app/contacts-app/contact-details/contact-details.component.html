<div class="contact-details" *ngIf="!contact">
    Select a contact to view or edit its details
</div>

<div class="contact-details" *ngIf="contact">
    <h2> {{ contact.full_name() || "New contact" }}'s details </h2>
    <form [formGroup]="contactForm">
        <table>
            <tr>
                <td> Nickname: </td>
                <td> <input formControlName="nickname"
                            placeholder="Nickname">
                </td>
            </tr>
            <tr>
                <td> First name: </td>
                <td> <input formControlName="first_name"
                            placeholder="First name">
                </td>
            </tr>
            <tr>
                <td> Last name: </td>
                <td> <input formControlName="last_name"
                            placeholder="Last Name">
                </td>
            </tr>
        </table>
        <table formArrayName="emails" *ngFor="let email of contactForm.get('emails').controls; let i=index">
            <tr [formGroupName]="i">
                <td> Email address: </td>
                <td *ngFor="let type of email.get('types').controls; let j=index">
                    <mat-select placeholder="Type" [formControl]="type">
                        <mat-option> None </mat-option>
                        <mat-option value="home">
                            <!--<mat-icon>home</mat-icon>-->
                            Personal
                        </mat-option>
                        <mat-option value="work">
                            <!--<mat-icon>work</mat-icon>-->
                            Work
                        </mat-option>
                    </mat-select>
                </td>
                <td>
                    <a mat-button (click)="addTypeToEmail(i)" *ngIf="!contact.rmm_backed">
                        <mat-icon>add</mat-icon>Add a type
                    </a>
                </td>
                <td>
                    <input formControlName="value"
                           placeholder="E-mail address">
                </td>
                <td>
                    <a mat-button routerLink="/compose" [queryParams]="{to: value}">
                        <mat-icon>email</mat-icon> Write an email to {{ contact.full_name() }}
                    </a>
                </td>
                <td>
                    <a mat-button (click)="removeEmailAt(i)" *ngIf="!contact.rmm_backed">
                        <mat-icon>delete</mat-icon>Delete this address
                    </a>
                </td>
        </table>
        <table formArrayName="addresses" *ngFor="let adr of contactForm.get('addresses').controls; let i=index">
            <tr [formGroupName]="i">
                <td> Address: </td>
                <td *ngFor="let type of adr.get('types').controls; let j=index">
                    <mat-select placeholder="Type" [formControl]="type">
                        <mat-option> None </mat-option>
                        <mat-option value="home">
                            <!--<mat-icon>home</mat-icon>-->
                            Home
                        </mat-option>
                        <mat-option value="work">
                            <!--<mat-icon>work</mat-icon>-->
                            Work
                        </mat-option>
                    </mat-select>
                </td>
                <!--
                <td>
                    <a mat-button (click)="addTypeToEmail(i)" *ngIf="!contact.rmm_backed">
                        <mat-icon>add</mat-icon>Add a type
                    </a>
                </td>
                -->
                <div formGroupName="value">
                    <td>
                        <input formControlName="street" placeholder="Street">
                    </td><td>
                        <input formControlName="city" placeholder="City">
                    </td><td>
                        <input formControlName="region" placeholder="Region">
                    </td><td>
                        <input formControlName="post_code" placeholder="Post code">
                    </td><td>
                        <input formControlName="country" placeholder="Country">
                    </td>
                </div>
                <!--
                <td>
                    <a mat-button (click)="removeEmailAt(i)" *ngIf="!contact.rmm_backed">
                        <mat-icon>delete</mat-icon>Delete this address
                    </a>
                </td>
                -->
        </table>
        <div>
            <a mat-button (click)="newEmail()" *ngIf="!contact.rmm_backed">Add a new email address</a>
        </div>
        <table>
            <tr>
                <td> Company: </td>
                <td> <input formControlName="company"
                            placeholder="Company">
                </td>
            </tr>
            <tr>
                <td> Department: </td>
                <td> <input formControlName="department"
                            placeholder="Department">
                </td>
            </tr>
        </table>
        <table>
            <tr>
                <td> Birthday: </td>
                <td> <input formControlName="birthday"
                            placeholder="Birthday">
                </td>
            </tr>
            <tr>
                <td> Notes: </td>
                <td> <textarea formControlName="note"
                               placeholder="Contact notes">
                     </textarea>
                </td>
            </tr>
        </table>
        <div *ngIf="contact.rmm_backed">
            <a mat-button (click)="edit_rmm6()">Edit this contact (in old webmail)</a>
        </div>
        <div *ngIf="!contact.rmm_backed">
            <a mat-button (click)="save()">Save changes</a>
            <a mat-button (click)="rollback()" *ngIf="contact.id">Discard changes</a>
            <a mat-button (click)="delete()" *ngIf="contact.id">Delete this contact</a>
        </div>
    </form>
</div>
